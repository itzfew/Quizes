<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>PDF Generator - NEET PYQs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/paper-css@0.3.0/paper.min.css">
    <style>
      @page { size: A4; margin: 10mm; }
      @media print {
        .footer { page-break-after: always; }
        .footer:last-child { page-break-after: avoid; }
        .noprint, .loader { display: none !important; }
        .sheet { margin: 0 !important; }
      }
      body { font-family: Arial, Helvetica, sans-serif; }
      .question {
        padding: 7px;
        font-size: 11pt;
        page-break-inside: avoid; /* Prevent questions from splitting */
      }
      .loader .spinner {
        border: 16px solid #f3f3f3;
        border-top: 16px solid blue;
        border-right: 16px solid green;
        border-bottom: 16px solid red;
        border-left: 16px solid pink;
        border-radius: 50%;
        margin: auto;
        width: 120px;
        height: 120px;
        animation: spin 2s linear infinite;
      }
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      #printDiv {
        display: flex;
        justify-content: center;
        display: none;
      }
      #printBtn {
        width: 800px;
        padding: 10px;
        margin: 20px;
        background: green;
        color: white;
        font-size: 20px;
        font-weight: bold;
        cursor: pointer;
      }
      .sheet .content .column { text-align: justify; font-size: 11pt; }
      .sheet .content .column blockquote { background: #DEDEDE; padding: 10px; margin: 4px 20px; clear: both; }
      .sheet .content .column h1 { padding: 0 10px; }
      .sheet .header { text-align: center; font-size: 18pt; padding: 20px 0 0; }
      .sheet .header .contact { float: right; font-size: 14pt; }
      .sheet .header .logo { float: left; vertical-align: middle; }
      .sheet .header hr, .sheet .footer hr { width: 800px; }
      .sheet .footer span { position: absolute; bottom: 10px; right: 10px; }
      .page_template { display: none; }
      table {
        table-layout: fixed;
        text-align: left;
        border-collapse: collapse;
        border: 1px solid black;
        width: 100%; /* Ensure table fits within column */
        max-width: 100%;
        word-wrap: break-word;
        page-break-inside: avoid; /* Prevent table splitting */
      }
      .content {
        padding: 10px;
        background: linear-gradient(#000, #000) no-repeat center/0.1px 99%;
        border-bottom: 1px solid black;
        min-height: 900px; /* Ensure consistent content height */
      }
      th, td {
        border: 1px solid black;
        padding: 5px;
        font-size: 10pt;
        overflow-wrap: break-word; /* Handle long content */
      }
      table tr td p { margin: 0 !important; }
      img { max-width: 100%; height: auto; } /* Prevent image overflow */
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://www.neetprep.com/jquery.columnizer.min.js"></script>
    <!-- Updated to MathJax v3 -->
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>
      $(function() {
        var content_height = 900; // Content height excluding header/footer
        var page = 1; // Starting page number

        // Function to compress tables
        function compressTables() {
          $('table').each(function() {
            var table = $(this);
            var tableWidth = table.width();
            var parentWidth = table.parent().width();
            if (tableWidth > parentWidth) {
              table.css('font-size', '9pt'); // Reduce font size
              table.find('td').css('padding', '3px'); // Reduce padding
            }
          });
        }

        // Function to handle image scaling
        function scaleImages() {
          $('.question img').each(function() {
            var img = $(this);
            if (img.width() > img.parent().width()) {
              img.css('width', '100%');
            }
          });
        }

        // Function to wait for MathJax rendering
        function waitForMathJax(callback) {
          if (typeof MathJax !== 'undefined') {
            MathJax.typesetPromise().then(() => {
              callback();
            }).catch(err => {
              console.error('MathJax rendering failed:', err);
              callback(); // Proceed even if MathJax fails
            });
          } else {
            callback(); // Proceed if MathJax is not loaded
          }
        }

        // Fetch questions from JSON
        $.getJSON('https://raw.githubusercontent.com/itzfew/Quizes/refs/heads/main/pyq/3c48616f-298a-5f69-91d2-bcd59444c455.json')
          .done(function(data) {
            var newsletterContent = $('#newsletterContent');

            // Group questions by subject
            var subjects = {};
            data.forEach(function(subjectData) {
              var subject = subjectData.subject;
              if (!subjects[subject]) {
                subjects[subject] = [];
              }
              subjects[subject].push(subjectData.questions);
            });

            // Render questions
            Object.keys(subjects).forEach(function(subject) {
              newsletterContent.append(
                '<div style="width: 100%; text-align: center; font-size: 32px;"><b>' +
                  subject.charAt(0).toUpperCase() + subject.slice(1) +
                '</b></div>'
              );
              subjects[subject].flat().forEach(function(q, index) {
                var questionHtml = '<div class="dontsplit question">' +
                  '<span class="questionId" style="vertical-align: top;"><b>' + (index + 1) + '.</b></span> ' +
                  '<p style="display:inline">' + q.content + '</p>';

                // Render options if available
                if (q.options && q.options.length > 0) {
                  questionHtml += '<table><tbody>';
                  for (var i = 0; i < q.options.length; i += 2) {
                    questionHtml += '<tr>' +
                      '<td style="width: 7%;">' + (i + 1) + '.</td>' +
                      '<td style="width: 43%;">' + q.options[i].content + '</td>';
                    if (i + 1 < q.options.length) {
                      questionHtml += '<td style="width: 7%;">' + (i + 2) + '.</td>' +
                        '<td style="width: 43%;">' + q.options[i + 1].content + '</td>';
                    }
                    questionHtml += '</tr>';
                  }
                  questionHtml += '</tbody></table>';
                }

                questionHtml += '<br><br></div>';
                newsletterContent.append(questionHtml);
              });
            });

            // Wait for MathJax to render, then build newsletter
            waitForMathJax(function() {
              setTimeout(buildNewsletter, 500); // Reduced timeout for faster rendering
            });
          })
          .fail(function(jqXHR, textStatus, errorThrown) {
            console.error('Failed to fetch JSON:', textStatus, errorThrown);
            $('.loader').hide();
            $('#printDiv').css('display', 'flex').append('<p style="color: red;">Failed to load questions. Please try again.</p>');
          });

        // Build newsletter pages
        function buildNewsletter() {
          scaleImages();
          compressTables();

          if ($('#newsletterContent').contents().length > 0) {
            var $page = $('.page_template:first').clone()
              .addClass('sheet padding-10mm')
              .css({ display: 'block', margin: 'auto' });
            $page.find('.footer span').append(page);
            $('body').append($page);
            page++;

            $('#newsletterContent').columnize({
              columns: 2,
              target: '.sheet:last .content',
              ignoreImageLoading: false,
              overflow: {
                height: content_height,
                id: '#newsletterContent',
                doneFunc: function() {
                  console.log('Done with page');
                  waitForMathJax(buildNewsletter); // Wait for MathJax on each page
                }
              }
            });
          } else {
            $('.loader').hide();
            $('#printDiv').css('display', 'flex');
            $('#newsletterContent').css('display', 'none');

            $('#printBtn').click(function() {
              window.print();
            });
          }
        }
      });
    </script>
  </head>
  <body class="A4">
    <div class="page_template">
      <div class="header">
        <img class="logo" src="https://www.neetprep.com/assets/img/logo.png" width="111" height="28">
        Full Test - NEET PYQs
        <span class="contact">Contact Number: 8527521718</span>
        <hr>
      </div>
      <div class="content"></div>
      <div class="footer"><span>Page: </span></div>
    </div>
    <div class="loader">
      <br><br>
      <div class="spinner"></div>
      <br><br>
      <h1 style="text-align: center;">Please be patient as the PDF generation may take up to a minute.</h1>
    </div>
    <div id="printDiv" class="noprint">
      <button id="printBtn">Print</button>
    </div>
    <div id="newsletterContent" style="visibility: hidden; display: block;"></div>
  </body>
</html> 
