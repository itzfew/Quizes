<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NEET PYQ PDF Generator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML" async></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      color: #333;
    }
    
    h1 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 30px;
    }
    
    .control-panel {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 30px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .input-group {
      margin-bottom: 15px;
    }
    
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
    }
    
    input, select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
    }
    
    button {
      background-color: #3498db;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: background-color 0.3s;
      width: 100%;
    }
    
    button:hover {
      background-color: #2980b9;
    }
    
    #generate-pdf {
      background-color: #27ae60;
      margin-top: 20px;
    }
    
    #generate-pdf:hover {
      background-color: #219653;
    }
    
    .hidden {
      display: none;
    }
    
    #pdf-preview {
      margin-top: 30px;
      border: 1px solid #ddd;
      padding: 20px;
      border-radius: 8px;
      background: white;
    }
    
    .page {
      background: white;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      break-inside: avoid;
    }
    
    .two-column {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
    }
    
    .question {
      margin-bottom: 30px;
      break-inside: avoid;
    }
    
    .question-number {
      font-weight: bold;
      color: #e74c3c;
      margin-bottom: 5px;
      display: flex;
      align-items: center;
    }
    
    .subject-tag {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
      margin-left: 10px;
    }
    
    .biology { background-color: #d5f5e3; color: #27ae60; }
    .chemistry { background-color: #d6eaf8; color: #2980b9; }
    .physics { background-color: #fadbd8; color: #e74c3c; }
    
    .question-content {
      margin-bottom: 15px;
    }
    
    .options {
      margin-left: 20px;
    }
    
    .option {
      margin-bottom: 8px;
    }
    
    .answer-key {
      margin-top: 50px;
      page-break-before: always;
    }
    
    .answer-item {
      margin-bottom: 25px;
    }
    
    .correct-answer {
      font-weight: bold;
      color: #27ae60;
    }
    
    .explanation {
      margin-top: 10px;
      padding: 10px;
      background-color: #f8f9fa;
      border-left: 3px solid #3498db;
      border-radius: 0 4px 4px 0;
    }
    
    .source {
      font-size: 12px;
      color: #7f8c8d;
      margin-top: 5px;
      font-style: italic;
    }
    
    @media print {
      body * {
        visibility: hidden;
      }
      #pdf-preview, #pdf-preview * {
        visibility: visible;
      }
      #pdf-preview {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        margin: 0;
        padding: 0;
        border: none;
      }
    }
    
    #loading {
      text-align: center;
      padding: 20px;
      font-size: 18px;
    }
    
    .fa-spinner {
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <h1>NEET PYQ PDF Generator</h1>
  
  <div class="control-panel">
    <div class="input-group">
      <label for="question-count">Number of Questions</label>
      <input type="number" id="question-count" min="3" max="150" value="30">
    </div>
    
    <div class="input-group">
      <label for="biology-percent">Biology Percentage</label>
      <input type="number" id="biology-percent" min="0" max="100" value="50">
    </div>
    
    <div class="input-group">
      <label for="chemistry-percent">Chemistry Percentage</label>
      <input type="number" id="chemistry-percent" min="0" max="100" value="25">
    </div>
    
    <div class="input-group">
      <label for="physics-percent">Physics Percentage</label>
      <input type="number" id="physics-percent" min="0" max="100" value="25">
    </div>
    
    <button id="generate-questions">Generate Questions</button>
  </div>
  
  <div id="loading" class="hidden">
    <i class="fas fa-spinner fa-spin"></i> Generating questions...
  </div>
  
  <div id="pdf-preview" class="hidden"></div>
  
  <button id="generate-pdf" class="hidden">
    <i class="fas fa-file-pdf"></i> Download PDF
  </button>

  <script>
    // Extensive question bank with realistic NEET questions
    const questionBank = {
      biology: [
        {
          id: 'bio1',
          content: 'Which of the following is the site of photosynthesis in plants?',
          options: [
            { id: 'a', content: 'Mitochondria' },
            { id: 'b', content: 'Chloroplast' },
            { id: 'c', content: 'Nucleus' },
            { id: 'd', content: 'Ribosome' }
          ],
          correct: ['b'],
          explanation: 'Chloroplasts are the organelles responsible for photosynthesis in plant cells. They contain chlorophyll which captures light energy.',
          source: 'NEET 2021'
        },
        {
          id: 'bio2',
          content: 'The process of conversion of light energy to chemical energy is called:',
          options: [
            { id: 'a', content: 'Respiration' },
            { id: 'b', content: 'Photosynthesis' },
            { id: 'c', content: 'Transpiration' },
            { id: 'd', content: 'Fermentation' }
          ],
          correct: ['b'],
          explanation: 'Photosynthesis is the process by which green plants convert light energy into chemical energy stored in glucose.',
          source: 'NEET 2020'
        },
        {
          id: 'bio3',
          content: 'Which of the following is NOT a part of the human digestive system?',
          options: [
            { id: 'a', content: 'Liver' },
            { id: 'b', content: 'Pancreas' },
            { id: 'c', content: 'Kidney' },
            { id: 'd', content: 'Stomach' }
          ],
          correct: ['c'],
          explanation: 'The kidney is part of the excretory system, not the digestive system. The liver, pancreas, and stomach are all digestive organs.',
          source: 'NEET 2019'
        },
        {
          id: 'bio4',
          content: 'The basic unit of life is:',
          options: [
            { id: 'a', content: 'Atom' },
            { id: 'b', content: 'Molecule' },
            { id: 'c', content: 'Cell' },
            { id: 'd', content: 'Tissue' }
          ],
          correct: ['c'],
          explanation: 'The cell is the smallest structural and functional unit of life, as proposed by the cell theory.',
          source: 'NEET 2018'
        },
        {
          id: 'bio5',
          content: 'Which of the following is responsible for carrying oxygen in blood?',
          options: [
            { id: 'a', content: 'Platelets' },
            { id: 'b', content: 'White blood cells' },
            { id: 'c', content: 'Red blood cells' },
            { id: 'd', content: 'Plasma' }
          ],
          correct: ['c'],
          explanation: 'Red blood cells contain hemoglobin which binds with oxygen and transports it throughout the body.',
          source: 'NEET 2017'
        },
        {
          id: 'bio6',
          content: 'The process of cell division that results in two identical daughter cells is called:',
          options: [
            { id: 'a', content: 'Meiosis' },
            { id: 'b', content: 'Mitosis' },
            { id: 'c', content: 'Binary fission' },
            { id: 'd', content: 'Budding' }
          ],
          correct: ['b'],
          explanation: 'Mitosis is the process of cell division that produces two genetically identical daughter cells from a single parent cell.',
          source: 'NEET 2016'
        },
        {
          id: 'bio7',
          content: 'Which of the following is NOT a function of the liver?',
          options: [
            { id: 'a', content: 'Production of bile' },
            { id: 'b', content: 'Detoxification of harmful substances' },
            { id: 'c', content: 'Storage of glycogen' },
            { id: 'd', content: 'Filtration of blood' }
          ],
          correct: ['d'],
          explanation: 'Blood filtration is primarily the function of the kidneys, not the liver. The liver performs many metabolic functions including bile production, detoxification, and glycogen storage.',
          source: 'NEET 2015'
        },
        {
          id: 'bio8',
          content: 'The hormone insulin is produced by:',
          options: [
            { id: 'a', content: 'Pituitary gland' },
            { id: 'b', content: 'Thyroid gland' },
            { id: 'c', content: 'Pancreas' },
            { id: 'd', content: 'Adrenal gland' }
          ],
          correct: ['c'],
          explanation: 'Insulin is produced by the beta cells of the islets of Langerhans in the pancreas. It regulates blood glucose levels.',
          source: 'NEET 2014'
        },
        {
          id: 'bio9',
          content: 'Which of the following is the correct sequence of stages in mitosis?',
          options: [
            { id: 'a', content: 'Prophase → Metaphase → Anaphase → Telophase' },
            { id: 'b', content: 'Metaphase → Prophase → Anaphase → Telophase' },
            { id: 'c', content: 'Anaphase → Prophase → Metaphase → Telophase' },
            { id: 'd', content: 'Prophase → Anaphase → Metaphase → Telophase' }
          ],
          correct: ['a'],
          explanation: 'The correct sequence of mitotic stages is Prophase (chromatin condenses), Metaphase (chromosomes align), Anaphase (chromatids separate), and Telophase (new nuclei form).',
          source: 'NEET 2013'
        },
        {
          id: 'bio10',
          content: 'The process by which plants lose water vapor through their leaves is called:',
          options: [
            { id: 'a', content: 'Transpiration' },
            { id: 'b', content: 'Respiration' },
            { id: 'c', content: 'Photosynthesis' },
            { id: 'd', content: 'Evaporation' }
          ],
          correct: ['a'],
          explanation: 'Transpiration is the process of water movement through a plant and its evaporation from aerial parts, mainly from the leaves.',
          source: 'NEET 2012'
        }
      ],
      chemistry: [
        {
          id: 'chem1',
          content: 'The pH of a neutral solution at 25°C is:',
          options: [
            { id: 'a', content: '0' },
            { id: 'b', content: '7' },
            { id: 'c', content: '14' },
            { id: 'd', content: '1' }
          ],
          correct: ['b'],
          explanation: 'At 25°C, a neutral solution has equal concentrations of H⁺ and OH⁻ ions, resulting in a pH of 7.',
          source: 'NEET 2021'
        },
        {
          id: 'chem2',
          content: 'Which of the following is NOT a noble gas?',
          options: [
            { id: 'a', content: 'Helium' },
            { id: 'b', content: 'Neon' },
            { id: 'c', content: 'Argon' },
            { id: 'd', content: 'Chlorine' }
          ],
          correct: ['d'],
          explanation: 'Chlorine is a halogen, not a noble gas. The noble gases are in Group 18 of the periodic table.',
          source: 'NEET 2020'
        },
        {
          id: 'chem3',
          content: 'The chemical formula of water is:',
          options: [
            { id: 'a', content: 'HO' },
            { id: 'b', content: 'H₂O' },
            { id: 'c', content: 'H₂O₂' },
            { id: 'd', content: 'HO₂' }
          ],
          correct: ['b'],
          explanation: 'Water consists of two hydrogen atoms bonded to one oxygen atom, hence the formula H₂O.',
          source: 'NEET 2019'
        },
        {
          id: 'chem4',
          content: 'Which of the following is an example of a chemical change?',
          options: [
            { id: 'a', content: 'Melting of ice' },
            { id: 'b', content: 'Boiling of water' },
            { id: 'c', content: 'Burning of wood' },
            { id: 'd', content: 'Dissolving sugar in water' }
          ],
          correct: ['c'],
          explanation: 'Burning wood results in new substances (ash, smoke) being formed, making it a chemical change.',
          source: 'NEET 2018'
        },
        {
          id: 'chem5',
          content: 'The atomic number represents the number of:',
          options: [
            { id: 'a', content: 'Protons' },
            { id: 'b', content: 'Neutrons' },
            { id: 'c', content: 'Electrons' },
            { id: 'd', content: 'Protons and neutrons' }
          ],
          correct: ['a'],
          explanation: 'The atomic number of an element is equal to the number of protons in its nucleus.',
          source: 'NEET 2017'
        },
        {
          id: 'chem6',
          content: 'Which of the following elements has the highest electronegativity?',
          options: [
            { id: 'a', content: 'Sodium (Na)' },
            { id: 'b', content: 'Chlorine (Cl)' },
            { id: 'c', content: 'Fluorine (F)' },
            { id: 'd', content: 'Oxygen (O)' }
          ],
          correct: ['c'],
          explanation: 'Fluorine has the highest electronegativity (3.98 on the Pauling scale) of all elements.',
          source: 'NEET 2016'
        },
        {
          id: 'chem7',
          content: 'The process of converting a solid directly to gas is called:',
          options: [
            { id: 'a', content: 'Evaporation' },
            { id: 'b', content: 'Sublimation' },
            { id: 'c', content: 'Condensation' },
            { id: 'd', content: 'Deposition' }
          ],
          correct: ['b'],
          explanation: 'Sublimation is the transition of a substance directly from the solid to the gas phase without passing through the intermediate liquid phase.',
          source: 'NEET 2015'
        },
        {
          id: 'chem8',
          content: 'Which of the following is NOT a property of acids?',
          options: [
            { id: 'a', content: 'Turns blue litmus red' },
            { id: 'b', content: 'Reacts with metals to produce hydrogen gas' },
            { id: 'c', content: 'Tastes bitter' },
            { id: 'd', content: 'Has a pH less than 7' }
          ],
          correct: ['c'],
          explanation: 'Acids taste sour, not bitter. Bases taste bitter and feel slippery.',
          source: 'NEET 2014'
        },
        {
          id: 'chem9',
          content: 'The number of electrons in the outermost shell of a nitrogen atom is:',
          options: [
            { id: 'a', content: '2' },
            { id: 'b', content: '5' },
            { id: 'c', content: '7' },
            { id: 'd', content: '8' }
          ],
          correct: ['b'],
          explanation: 'Nitrogen (atomic number 7) has an electron configuration of 2,5, meaning it has 5 valence electrons in its outermost shell.',
          source: 'NEET 2013'
        },
        {
          id: 'chem10',
          content: 'Which of the following is a characteristic of a chemical equilibrium?',
          options: [
            { id: 'a', content: 'Forward and reverse reactions stop' },
            { id: 'b', content: 'Concentrations of reactants and products become equal' },
            { id: 'c', content: 'Forward and reverse reaction rates become equal' },
            { id: 'd', content: 'No reactions occur in either direction' }
          ],
          correct: ['c'],
          explanation: 'At chemical equilibrium, the rates of the forward and reverse reactions are equal, but the reactions continue to occur.',
          source: 'NEET 2012'
        }
      ],
      physics: [
        {
          id: 'phy1',
          content: 'The SI unit of force is:',
          options: [
            { id: 'a', content: 'Joule' },
            { id: 'b', content: 'Newton' },
            { id: 'c', content: 'Watt' },
            { id: 'd', content: 'Pascal' }
          ],
          correct: ['b'],
          explanation: 'The newton (N) is the SI derived unit of force. It is defined as 1 kg·m/s².',
          source: 'NEET 2021'
        },
        {
          id: 'phy2',
          content: 'Which of the following is a vector quantity?',
          options: [
            { id: 'a', content: 'Mass' },
            { id: 'b', content: 'Speed' },
            { id: 'c', content: 'Distance' },
            { id: 'd', content: 'Velocity' }
          ],
          correct: ['d'],
          explanation: 'Velocity is a vector quantity because it has both magnitude and direction.',
          source: 'NEET 2020'
        },
        {
          id: 'phy3',
          content: 'The acceleration due to gravity on Earth is approximately:',
          options: [
            { id: 'a', content: '9.8 m/s²' },
            { id: 'b', content: '6.7 m/s²' },
            { id: 'c', content: '3.0 × 10⁸ m/s²' },
            { id: 'd', content: '1.6 m/s²' }
          ],
          correct: ['a'],
          explanation: 'The standard acceleration due to gravity on Earth is 9.80665 m/s², often rounded to 9.8 m/s².',
          source: 'NEET 2019'
        },
        {
          id: 'phy4',
          content: 'Ohm\'s Law relates which of the following quantities?',
          options: [
            { id: 'a', content: 'Force, mass, acceleration' },
            { id: 'b', content: 'Voltage, current, resistance' },
            { id: 'c', content: 'Work, energy, power' },
            { id: 'd', content: 'Speed, distance, time' }
          ],
          correct: ['b'],
          explanation: 'Ohm\'s Law states that V = IR, relating voltage (V), current (I), and resistance (R).',
          source: 'NEET 2018'
        },
        {
          id: 'phy5',
          content: 'The first law of thermodynamics is a restatement of:',
          options: [
            { id: 'a', content: 'Conservation of mass' },
            { id: 'b', content: 'Conservation of energy' },
            { id: 'c', content: 'Conservation of momentum' },
            { id: 'd', content: 'Conservation of charge' }
          ],
          correct: ['b'],
          explanation: 'The first law of thermodynamics states that energy cannot be created or destroyed, only transformed.',
          source: 'NEET 2017'
        },
        {
          id: 'phy6',
          content: 'Which of the following electromagnetic waves has the shortest wavelength?',
          options: [
            { id: 'a', content: 'Radio waves' },
            { id: 'b', content: 'Microwaves' },
            { id: 'c', content: 'X-rays' },
            { id: 'd', content: 'Infrared' }
          ],
          correct: ['c'],
          explanation: 'X-rays have wavelengths in the range of 0.01 to 10 nanometers, much shorter than the other options listed.',
          source: 'NEET 2016'
        },
        {
          id: 'phy7',
          content: 'The unit of electric potential difference is:',
          options: [
            { id: 'a', content: 'Ampere' },
            { id: 'b', content: 'Ohm' },
            { id: 'c', content: 'Volt' },
            { id: 'd', content: 'Watt' }
          ],
          correct: ['c'],
          explanation: 'The volt (V) is the derived unit for electric potential, electric potential difference (voltage), and electromotive force.',
          source: 'NEET 2015'
        },
        {
          id: 'phy8',
          content: 'The phenomenon by which light bends when it passes from one medium to another is called:',
          options: [
            { id: 'a', content: 'Reflection' },
            { id: 'b', content: 'Refraction' },
            { id: 'c', content: 'Diffraction' },
            { id: 'd', content: 'Dispersion' }
          ],
          correct: ['b'],
          explanation: 'Refraction is the change in direction of a wave passing from one medium to another caused by its change in speed.',
          source: 'NEET 2014'
        },
        {
          id: 'phy9',
          content: 'Which of the following is NOT a fundamental force of nature?',
          options: [
            { id: 'a', content: 'Gravitational force' },
            { id: 'b', content: 'Electromagnetic force' },
            { id: 'c', content: 'Strong nuclear force' },
            { id: 'd', content: 'Frictional force' }
          ],
          correct: ['d'],
          explanation: 'The four fundamental forces are gravity, electromagnetism, strong nuclear force, and weak nuclear force. Friction is not fundamental.',
          source: 'NEET 2013'
        },
        {
          id: 'phy10',
          content: 'The energy stored in a stretched spring is:',
          options: [
            { id: 'a', content: 'Kinetic energy' },
            { id: 'b', content: 'Potential energy' },
            { id: 'c', content: 'Thermal energy' },
            { id: 'd', content: 'Chemical energy' }
          ],
          correct: ['b'],
          explanation: 'A stretched spring stores elastic potential energy, which is a form of potential energy.',
          source: 'NEET 2012'
        }
      ]
    };

    document.getElementById('generate-questions').addEventListener('click', generateQuestions);
    document.getElementById('generate-pdf').addEventListener('click', generatePDF);

    function generateQuestions() {
      const totalQuestions = parseInt(document.getElementById('question-count').value);
      const bioPercent = parseInt(document.getElementById('biology-percent').value);
      const chemPercent = parseInt(document.getElementById('chemistry-percent').value);
      const physPercent = parseInt(document.getElementById('physics-percent').value);
      
      // Validate percentages
      if (bioPercent + chemPercent + physPercent !== 100) {
        alert('Percentages must add up to 100%');
        return;
      }
      
      // Calculate number of questions per subject
      const bioCount = Math.round(totalQuestions * bioPercent / 100);
      const chemCount = Math.round(totalQuestions * chemPercent / 100);
      const physCount = totalQuestions - bioCount - chemCount; // Adjust for rounding
      
      document.getElementById('loading').classList.remove('hidden');
      document.getElementById('pdf-preview').classList.add('hidden');
      document.getElementById('generate-pdf').classList.add('hidden');
      
      // Simulate loading delay
      setTimeout(() => {
        // Select random questions from each subject
        const selectedQuestions = [];
        
        // Shuffle and select biology questions
        const bioQuestions = [...questionBank.biology].sort(() => 0.5 - Math.random()).slice(0, bioCount);
        selectedQuestions.push(...bioQuestions.map(q => ({ ...q, subject: 'biology' })));
        
        // Shuffle and select chemistry questions
        const chemQuestions = [...questionBank.chemistry].sort(() => 0.5 - Math.random()).slice(0, chemCount);
        selectedQuestions.push(...chemQuestions.map(q => ({ ...q, subject: 'chemistry' })));
        
        // Shuffle and select physics questions
        const physQuestions = [...questionBank.physics].sort(() => 0.5 - Math.random()).slice(0, physCount);
        selectedQuestions.push(...physQuestions.map(q => ({ ...q, subject: 'physics' })));
        
        // Shuffle all selected questions
        const shuffledQuestions = selectedQuestions.sort(() => 0.5 - Math.random());
        
        // Assign question numbers
        const numberedQuestions = shuffledQuestions.map((q, i) => ({ ...q, number: i + 1 }));
        
        renderPDFPreview(numberedQuestions);
        
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('pdf-preview').classList.remove('hidden');
        document.getElementById('generate-pdf').classList.remove('hidden');
      }, 500);
    }
    
    function renderPDFPreview(questions) {
      const preview = document.getElementById('pdf-preview');
      preview.innerHTML = '';
      
      // Create questions section
      const questionsSection = document.createElement('div');
      questionsSection.innerHTML = '<h2>NEET Practice Questions</h2>';
      
      // Split questions into pages (10 questions per page, 5 per column)
      const questionsPerPage = 10;
      const pageCount = Math.ceil(questions.length / questionsPerPage);
      
      for (let page = 0; page < pageCount; page++) {
        const pageDiv = document.createElement('div');
        pageDiv.className = 'page';
        
        const pageTitle = document.createElement('h3');
        pageTitle.textContent = `Page ${page + 1} of ${pageCount}`;
        pageDiv.appendChild(pageTitle);
        
        const twoColDiv = document.createElement('div');
        twoColDiv.className = 'two-column';
        
        const startIdx = page * questionsPerPage;
        const endIdx = Math.min(startIdx + questionsPerPage, questions.length);
        
        for (let i = startIdx; i < endIdx; i++) {
          const q = questions[i];
          const questionDiv = document.createElement('div');
          questionDiv.className = 'question';
          
          // Create question number with subject tag
          const numberDiv = document.createElement('div');
          numberDiv.className = 'question-number';
          numberDiv.innerHTML = `Q${q.number} <span class="subject-tag ${q.subject}">${q.subject.toUpperCase()}</span>`;
          questionDiv.appendChild(numberDiv);
          
          // Add question content
          const contentDiv = document.createElement('div');
          contentDiv.className = 'question-content';
          contentDiv.innerHTML = renderMath(q.content);
          questionDiv.appendChild(contentDiv);
          
          // Add options
          const optionsDiv = document.createElement('div');
          optionsDiv.className = 'options';
          
          q.options.forEach((opt, idx) => {
            const optDiv = document.createElement('div');
            optDiv.className = 'option';
            optDiv.innerHTML = `${String.fromCharCode(65 + idx)}. ${renderMath(opt.content)}`;
            optionsDiv.appendChild(optDiv);
          });
          
          questionDiv.appendChild(optionsDiv);
          
          // Add source
          const sourceDiv = document.createElement('div');
          sourceDiv.className = 'source';
          sourceDiv.textContent = `Source: ${q.source}`;
          questionDiv.appendChild(sourceDiv);
          
          twoColDiv.appendChild(questionDiv);
        }
        
        pageDiv.appendChild(twoColDiv);
        questionsSection.appendChild(pageDiv);
      }
      
      preview.appendChild(questionsSection);
      
      // Create answer key section
      const answerSection = document.createElement('div');
      answerSection.className = 'answer-key';
      answerSection.innerHTML = '<h2>Answer Key</h2>';
      
      questions.forEach(q => {
        const answerDiv = document.createElement('div');
        answerDiv.className = 'answer-item';
        
        // Get correct options as letters (A, B, C, etc.)
        const correctLetters = q.correct.map(optId => {
          const optIndex = q.options.findIndex(o => o.id === optId);
          return String.fromCharCode(65 + optIndex);
        }).join(', ');
        
        answerDiv.innerHTML = `
          <div><strong>Q${q.number}</strong> (${q.subject.toUpperCase()}): 
            <span class="correct-answer">${correctLetters}</span>
          </div>
          <div class="explanation">
            <strong>Explanation:</strong> ${q.explanation}
          </div>
        `;
        
        answerSection.appendChild(answerDiv);
      });
      
      preview.appendChild(answerSection);
      
      // Render MathJax after content is loaded
      if (typeof MathJax !== 'undefined') {
        MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
      }
    }
    
    function generatePDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({
        orientation: 'portrait',
        unit: 'mm',
        format: 'a4'
      });
      
      // Add title page
      doc.setFontSize(24);
      doc.setTextColor(40, 40, 40);
      doc.text('NEET Previous Year Questions', 105, 30, { align: 'center' });
      
      doc.setFontSize(16);
      doc.text('Practice Questions with Answers', 105, 40, { align: 'center' });
      
      const totalQuestions = document.getElementById('question-count').value;
      doc.setFontSize(14);
      doc.text(`Total Questions: ${totalQuestions}`, 105, 50, { align: 'center' });
      
      const date = new Date().toLocaleDateString();
      doc.setFontSize(12);
      doc.text(`Generated on: ${date}`, 105, 60, { align: 'center' });
      
      // Add a new page for questions
      doc.addPage();
      
      // Get the HTML content to convert to PDF
      const element = document.getElementById('pdf-preview');
      
      // Use html2canvas to convert HTML to canvas
      html2canvas(element, {
        scale: 2,
        logging: false,
        useCORS: true,
        allowTaint: true,
        scrollX: 0,
        scrollY: 0
      }).then(canvas => {
        const imgData = canvas.toDataURL('image/png');
        const imgWidth = doc.internal.pageSize.getWidth() - 20;
        const pageHeight = doc.internal.pageSize.getHeight() - 20;
        const imgHeight = canvas.height * imgWidth / canvas.width;
        
        let heightLeft = imgHeight;
        let position = 10;
        
        doc.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
        heightLeft -= pageHeight;
        
        // Add new pages if content is too long
        while (heightLeft >= 0) {
          position = heightLeft - imgHeight;
          doc.addPage();
          doc.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
          heightLeft -= pageHeight;
        }
        
        // Save the PDF
        doc.save('NEET-Practice-Questions.pdf');
      });
    }
    
    function renderMath(input) {
      if (!input) return '';
      // Simple math rendering - in a real app you'd use MathJax more extensively
      return input
        .replace(/\$\$(.*?)\$\$/g, '<span class="mathjax">$$$1$$</span>')
        .replace(/\$(.*?)\$/g, '<span class="mathjax">$1</span>');
    }
    
    // Initialize MathJax configuration
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ['\\(','\\)'] ],
        displayMath: [ ['$$','$$'], ['\\[','\\]'] ],
        processEscapes: true,
        processEnvironments: true
      },
      CommonHTML: { linebreaks: { automatic: true } },
      "HTML-CSS": { linebreaks: { automatic: true } },
      SVG: { linebreaks: { automatic: true } }
    });
  </script>
</body>
</html>
