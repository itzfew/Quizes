<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Question Detail</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
            padding: 20px;
            max-width: 100%;
            overflow-x: hidden;
        }
        
        /* Header and Navigation */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }
        
        .back-btn {
            background-color: #4a6fa5;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        .back-btn:hover {
            background-color: #3a5a80;
        }
        
        .timer {
            background-color: #e74c3c;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        /* Question Container */
        .question-container {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .question-text {
            font-size: 1.2rem;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        /* Options List */
        .options-list {
            list-style: none;
            margin-bottom: 25px;
        }
        
        .option {
            padding: 12px 15px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
        }
        
        .option:hover {
            background-color: #f0f8ff;
            border-color: #b3d9ff;
        }
        
        .option.selected {
            background-color: #d4e6f7;
            border-color: #4a90e2;
        }
        
        .option.correct {
            background-color: #d4edda;
            border-color: #28a745;
        }
        
        .option.incorrect {
            background-color: #f8d7da;
            border-color: #dc3545;
        }
        
        .option-prefix {
            font-weight: bold;
            margin-right: 10px;
            min-width: 20px;
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-check {
            background-color: #17a2b8;
            color: white;
        }
        
        .btn-check:hover {
            background-color: #138496;
        }
        
        .btn-next {
            background-color: #28a745;
            color: white;
        }
        
        .btn-next:hover {
            background-color: #218838;
        }
        
        /* Explanation Section */
        .explanation {
            display: none;
            margin-top: 25px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #17a2b8;
        }
        
        .explanation-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #17a2b8;
        }
        
        .explanation-content {
            line-height: 1.5;
        }
        
        /* Source Information */
        .source-info {
            text-align: center;
            margin-top: 15px;
            font-style: italic;
            color: #6c757d;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .question-text {
                font-size: 1.1rem;
            }
            
            .option {
                padding: 10px 12px;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <button class="back-btn" id="backBtn">‚Üê Back</button>
        <div class="timer" id="timer">Time: 2:00</div>
    </div>
    
    <div class="question-container">
        <div class="source-info" id="sourceInfo"></div>
        <div id="questionContent">
            <!-- Question content will be loaded here -->
        </div>
        
        <ul class="options-list" id="optionsList">
            <!-- Options will be loaded here -->
        </ul>
        
        <div class="action-buttons">
            <button class="btn btn-check" id="checkBtn">Check Answer</button>
            <button class="btn btn-next" id="nextBtn">Next Question</button>
        </div>
        
        <div class="explanation" id="explanation">
            <div class="explanation-title">Explanation:</div>
            <div class="explanation-content" id="explanationContent"></div>
        </div>
    </div>

    <script>
        // Question data
        const examMetaData = [
            { id: "3c48616f-298a-5f69-91d2-bcd59444c455", title: "NEET 2023 Manipur" },
            { id: "cbfbed57-d7d8-5a07-9957-478e4cb62f17", title: "NEET 2023" },
            { id: "8dd253c6-09a8-5875-b127-a0c00a165a1b", title: "NEET 2022 Phase 2" },
            { id: "c7fb1fc7-cb24-58d1-99f5-4ced0111082d", title: "NEET 2022 Phase 1" },
            { id: "2ff56f11-0061-566e-aeca-9cc14246e8fb", title: "NEET 2021" },
            { id: "27ba990b-5085-5196-87dd-9727f95fc228", title: "NEET 2020 Phase 1" },
            { id: "c3ae87e9-4094-514a-b2a4-b6e98b1d7ec3", title: "NEET 2019" },
            { id: "ce68b80b-fff0-5db8-8d6a-668d729d487a", title: "NEET 2018" },
            { id: "57222784-be0a-5653-930c-8ac44c689e21", title: "NEET 2017" },
            { id: "80eef6f1-3522-515e-b73d-339d85018141", title: "NEET 2016 Phase 2" },
            { id: "938f3847-eb62-525b-b1b0-02ee459e81f8", title: "NEET 2016 Phase 1" },
            { id: "47778809-6194-57b2-868a-e4fedb6e9f3a", title: "AIPMT 2015" },
            { id: "8713af28-1c8f-53cc-9230-bcc6ea3843c9", title: "AIPMT 2015 Cancelled Paper" },
            { id: "8756d5f2-5c2a-506e-af0c-0198c9fc2187", title: "AIPMT 2014" },
            { id: "1c4dc710-3261-5cd5-bb3e-ee281740f624", title: "NEET 2013 (Karnataka)" },
            { id: "48007b77-2c75-5367-9ca7-98b53cceaca8", title: "NEET 2013" },
            { id: "068d67b3-bca5-5dc4-af63-9dbf0f7ce7be", title: "AIPMT 2012 Mains" },
            { id: "9bdb3f61-14cf-57d2-9324-5465da11de4d", title: "AIPMT 2012 Prelims" },
            { id: "a3afa98f-582a-5a4c-ada4-d17ad73090be", title: "AIPMT 2011 Mains" },
            { id: "dfc116dc-cf26-5489-aa89-99266a7512a9", title: "AIPMT 2011 Prelims" },
            { id: "da3ac707-aeab-5c4d-807e-6a0705098929", title: "AIPMT 2010 Mains" },
            { id: "b91bcb0a-a1ae-550b-a078-b25fcbd422ee", title: "AIPMT 2010 Prelims" },
            { id: "b0e9a6d4-f603-58b1-9723-66c27d5c959b", title: "AIPMT 2009" },
            { id: "4432d9cf-5356-5982-b930-2f9d9d752fef", title: "AIPMT 2008" },
            { id: "4076c9ee-750f-5bd9-a821-c59bed8ab4fd", title: "AIPMT 2007" },
            { id: "084ad628-cb2a-5390-80d1-ccc658633f19", title: "AIPMT 2006" },
            { id: "6c2de931-ef9f-52bc-af22-bebe0c0ff520", title: "AIPMT 2005" },
            { id: "e537df27-eaab-55a1-9a01-c84409f04935", title: "AIPMT 2004" },
            { id: "9f3fa1a4-1199-5b24-b381-d7df26102489", title: "AIPMT 2003" },
            { id: "3dbc2670-9688-5143-ae78-7fb777e3eaf6", title: "AIPMT 2002" },
            { id: "762be6c6-de8f-548d-859d-3a2343237947", title: "AIPMT 2001" },
            { id: "d594604a-f9e6-5929-b3bf-b720a34fabe3", title: "AIPMT 2000" }
        ];

        // Global variables
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let timerInterval;
        let currentSubject, currentChapter, currentQuestionId;
        
        // DOM elements
        const backBtn = document.getElementById('backBtn');
        const timerElement = document.getElementById('timer');
        const sourceInfoElement = document.getElementById('sourceInfo');
        const questionContentElement = document.getElementById('questionContent');
        const optionsListElement = document.getElementById('optionsList');
        const checkBtn = document.getElementById('checkBtn');
        const nextBtn = document.getElementById('nextBtn');
        const explanationElement = document.getElementById('explanation');
        const explanationContentElement = document.getElementById('explanationContent');

        // Initialize the page
        document.addEventListener('DOMContentLoaded', () => {
            parseUrlParameters();
            loadQuestionData();
            setupEventListeners();
        });

        // Parse URL parameters
        function parseUrlParameters() {
            const urlParams = new URLSearchParams(window.location.search);
            const idParam = urlParams.get('id');
            
            if (!idParam) {
                console.error('No ID parameter found in URL');
                return;
            }
            
            const parts = idParam.split('/');
            if (parts.length !== 3) {
                console.error('Invalid ID parameter format');
                return;
            }
            
            currentSubject = parts[0];
            currentChapter = parts[1];
            currentQuestionId = parts[2];
        }

        // Load question data
        async function loadQuestionData() {
            try {
                // Find the exam data that contains our question
                for (const exam of examMetaData) {
                    const response = await fetch(`https://raw.githubusercontent.com/itzfew/Quizes/main/pyq/${exam.id}.json`);
                    const examData = await response.json();
                    
                    // Determine which subject array to use (0: biology, 1: chemistry, 2: physics)
                    let subjectIndex;
                    if (currentSubject === 'biology') subjectIndex = 0;
                    else if (currentSubject === 'chemistry') subjectIndex = 1;
                    else if (currentSubject === 'physics') subjectIndex = 2;
                    else continue;
                    
                    // Filter questions for the current chapter and subject
                    const questions = examData[subjectIndex].questions.filter(
                        q => q.chapter === currentChapter && q.subject === currentSubject
                    );
                    
                    if (questions.length > 0) {
                        currentQuestions = questions;
                        currentQuestionIndex = questions.findIndex(q => q.question_id === currentQuestionId);
                        sourceInfoElement.textContent = `Source: ${exam.title}`;
                        renderQuestion();
                        startTimer();
                        return;
                    }
                }
                
                // If we get here, no questions were found
                questionContentElement.innerHTML = '<p>Question not found.</p>';
                
            } catch (error) {
                console.error('Error loading question data:', error);
                questionContentElement.innerHTML = '<p>Error loading question. Please try again.</p>';
            }
        }

        // Render the current question
        function renderQuestion() {
            if (currentQuestionIndex < 0 || currentQuestionIndex >= currentQuestions.length) {
                questionContentElement.innerHTML = '<p>Question not found.</p>';
                return;
            }
            
            const question = currentQuestions[currentQuestionIndex];
            currentQuestionId = question.question_id;
            
            // Update URL without reloading the page
            const newUrl = `?id=${currentSubject}/${currentChapter}/${currentQuestionId}`;
            window.history.pushState({ path: newUrl }, '', newUrl);
            
            // Render question content
            questionContentElement.innerHTML = `
                <div class="question-text">${formatContent(question.content)}</div>
            `;
            
            // Render options
            optionsListElement.innerHTML = '';
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('li');
                optionElement.className = 'option';
                optionElement.dataset.option = option.identifier;
                optionElement.innerHTML = `
                    <span class="option-prefix">${String.fromCharCode(65 + index)}.</span>
                    ${formatContent(option.content)}
                `;
                optionsListElement.appendChild(optionElement);
                
                // Check if this option was previously selected
                const savedAnswer = localStorage.getItem(`answer-${currentQuestionId}`);
                if (savedAnswer === option.identifier) {
                    optionElement.classList.add('selected');
                }
            });
            
            // Render explanation (hidden by default)
            explanationContentElement.innerHTML = formatContent(question.explanation);
            explanationElement.style.display = 'none';
            
            // Process MathJax
            if (window.MathJax) {
                MathJax.typesetPromise();
            }
        }

        // Format content (handles LaTeX and other formatting)
        function formatContent(content) {
            // Simple LaTeX handling - you might want to enhance this
            return content.replace(/\$\$(.*?)\$\$/g, '<span class="math-tex">$$$1$$</span>');
        }

        // Start the timer
        function startTimer() {
            let timeLeft = 120; // 2 minutes in seconds
            
            // Clear any existing timer
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            
            // Update timer immediately
            updateTimerDisplay(timeLeft);
            
            // Start countdown
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay(timeLeft);
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    checkAnswer();
                    alert("Time's up! Your answer has been submitted.");
                }
            }, 1000);
        }

        // Update timer display
        function updateTimerDisplay(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            timerElement.textContent = `Time: ${mins}:${secs < 10 ? '0' + secs : secs}`;
        }

        // Check the selected answer
        function checkAnswer() {
            const selectedOption = document.querySelector('.option.selected');
            
            if (!selectedOption) {
                alert('Please select an answer before checking.');
                return;
            }
            
            const question = currentQuestions[currentQuestionIndex];
            const correctOptionId = question.options.find(opt => opt.is_correct)?.identifier;
            
            // Highlight correct and incorrect answers
            document.querySelectorAll('.option').forEach(option => {
                if (option.dataset.option === correctOptionId) {
                    option.classList.add('correct');
                } else if (option === selectedOption && option.dataset.option !== correctOptionId) {
                    option.classList.add('incorrect');
                }
            });
            
            // Show explanation
            explanationElement.style.display = 'block';
            
            // Disable further selection
            document.querySelectorAll('.option').forEach(option => {
                option.style.pointerEvents = 'none';
            });
            
            // Save the answer
            localStorage.setItem(`answer-${currentQuestionId}`, selectedOption.dataset.option);
        }

        // Load the next question
        function loadNextQuestion() {
            // First check if an answer has been selected and checked
            const explanationVisible = explanationElement.style.display === 'block';
            
            if (!explanationVisible) {
                alert('Please check your answer before proceeding to the next question.');
                return;
            }
            
            // Move to next question or wrap around
            currentQuestionIndex = (currentQuestionIndex + 1) % currentQuestions.length;
            renderQuestion();
            
            // Restart timer for new question
            startTimer();
        }

        // Setup event listeners
        function setupEventListeners() {
            // Option selection
            optionsListElement.addEventListener('click', (e) => {
                const option = e.target.closest('.option');
                if (!option) return;
                
                // Remove selection from other options
                document.querySelectorAll('.option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                
                // Select clicked option
                option.classList.add('selected');
            });
            
            // Check answer button
            checkBtn.addEventListener('click', checkAnswer);
            
            // Next question button
            nextBtn.addEventListener('click', loadNextQuestion);
            
            // Back button
            backBtn.addEventListener('click', () => {
                window.location.href = `subject.html?subject=${currentSubject}&chapter=${currentChapter}`;
            });
            
            // Handle browser back/forward buttons
            window.addEventListener('popstate', () => {
                parseUrlParameters();
                loadQuestionData();
            });
        }
    </script>
</body>
</html>
