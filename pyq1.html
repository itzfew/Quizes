<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Quiz Game</title>
    <script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }

        .quiz-title {
            font-size: 1.5em;
            margin: 5px 0;
            color: #333;
            text-align: center;
            border: 2px solid black;
            background-color: white;
            padding: 10px;
        }

        .print-button {
            display: block;
            margin: 10px auto;
            padding: 10px 20px;
            background-color: #000;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .page-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            width: 100%;
            max-width: 210mm; /* A4 width */
            margin: 0 auto;
            background-color: white;
            padding: 10mm;
            box-sizing: border-box;
            page-break-after: always;
        }

        .column {
            width: 48%;
            box-sizing: border-box;
        }

        .question {
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            page-break-inside: avoid;
        }

        .question-number {
            font-weight: bold;
            font-size: 1.1em;
            color: #333;
            margin-bottom: 5px;
        }

        .question-content {
            margin-bottom: 10px;
            word-wrap: break-word;
        }

        .options {
            list-style-type: none;
            padding-left: 0;
        }

        .options li {
            margin-bottom: 8px;
            padding: 5px;
        }

        .options label {
            cursor: pointer;
            display: flex;
            align-items: flex-start;
        }

        .options input[type="radio"] {
            margin-right: 8px;
            margin-top: 3px;
        }

        .question-id {
            font-weight: bold;
            margin-bottom: 5px;
            color: #555;
            font-size: 0.9em;
        }

        .correct-answer {
            margin-top: 5px;
            font-weight: bold;
            color: green;
            font-size: 0.9em;
        }

        .explanation-button {
            margin-top: 5px;
            background-color: white;
            color: black;
            border: 1px solid black;
            cursor: pointer;
            padding: 5px 10px;
            font-size: 0.9em;
        }

        .explanation-content {
            display: none;
            margin-top: 5px;
            font-style: italic;
            color: #777;
            font-size: 0.9em;
            background-color: #FFF59D;
            padding: 5px;
            border-radius: 3px;
        }

        .explanation-content.open {
            display: block;
        }

        .subject-title {
            font-size: 1.3em;
            font-weight: bold;
            margin: 15px 0 10px 0;
            padding-bottom: 5px;
            border-bottom: 2px solid #333;
        }

        @media print {
            body {
                background-color: white;
            }
            .print-button, .explanation-button {
                display: none !important;
            }
            .page-container {
                padding: 0;
                margin: 0;
                max-width: 100%;
            }
            .column {
                width: 48%;
            }
        }

        @media (max-width: 768px) {
            .column {
                width: 100%;
            }
            .page-container {
                padding: 5mm;
            }
        }

        @media (min-width: 769px) and (max-width: 1024px) {
            .column {
                width: 48%;
            }
        }

        /* MathJax specific styling */
        .mathjax-inline {
            white-space: nowrap;
            display: inline-block;
        }

        /* Ensure images don't overflow */
        img {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <div class="quiz-title" id="quiz-title"></div>
    <button class="print-button" onclick="window.print()"><i class="fas fa-print"></i> Print Questions</button>
    <div id="quiz-container"></div>

    <script>
        let quizData = [];
        const urlParams = new URLSearchParams(window.location.search);
        const title = urlParams.get('title');
        const metaId = urlParams.get('metaId');

        if (title) {
            document.getElementById('quiz-title').textContent = title;
        }

        const jsonUrl = `https://raw.githubusercontent.com/itzfew/Quizes/refs/heads/main/pyq/${metaId}.json`;

        // Fetch the JSON data
        fetch(jsonUrl)
            .then(response => response.json())
            .then(data => {
                quizData = data;
                displayAllQuestions();
            })
            .catch(error => console.error('Error fetching the JSON data:', error));

        function displayAllQuestions() {
            const quizContainer = document.getElementById('quiz-container');
            quizContainer.innerHTML = '';

            // Combine all subjects' questions
            let allQuestions = [];
            quizData.forEach(subject => {
                allQuestions = allQuestions.concat(subject.questions.map(q => ({
                    ...q,
                    subjectTitle: subject.title
                })));
            });

            // Group by subject (Bio, Chem, Phy order)
            const subjectsOrder = ['Biology', 'Chemistry', 'Physics'];
            const groupedQuestions = {};
            
            subjectsOrder.forEach(subject => {
                groupedQuestions[subject] = allQuestions.filter(q => q.subjectTitle === subject);
            });

            // Create pages with two columns
            createPages(allQuestions, quizContainer);

            // Re-render MathJax content
            MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
        }

        function createPages(questions, container) {
            const questionsPerPage = estimateQuestionsPerPage();
            let currentPage = 1;
            let currentColumn = 1;
            let questionsInCurrentColumn = 0;
            
            // Create first page
            let pageContainer = createPageContainer(container, currentPage);
            let column1 = createColumn(pageContainer, 1);
            let column2 = createColumn(pageContainer, 2);
            
            let currentColumnElement = column1;
            let currentSubject = null;
            
            for (let i = 0; i < questions.length; i++) {
                const question = questions[i];
                
                // Add subject title if it's a new subject
                if (currentSubject !== question.subjectTitle) {
                    currentSubject = question.subjectTitle;
                    const subjectTitleElement = document.createElement('div');
                    subjectTitleElement.className = 'subject-title';
                    subjectTitleElement.textContent = currentSubject;
                    currentColumnElement.appendChild(subjectTitleElement);
                    questionsInCurrentColumn++; // Count subject title as space
                }
                
                // Check if we need to switch columns or pages
                if (questionsInCurrentColumn >= questionsPerPage) {
                    if (currentColumn === 1) {
                        currentColumn = 2;
                        currentColumnElement = column2;
                    } else {
                        currentPage++;
                        pageContainer = createPageContainer(container, currentPage);
                        column1 = createColumn(pageContainer, 1);
                        column2 = createColumn(pageContainer, 2);
                        currentColumn = 1;
                        currentColumnElement = column1;
                    }
                    questionsInCurrentColumn = 0;
                    
                    // Add subject title again if we switched columns/pages
                    if (currentSubject) {
                        const subjectTitleElement = document.createElement('div');
                        subjectTitleElement.className = 'subject-title';
                        subjectTitleElement.textContent = currentSubject;
                        currentColumnElement.appendChild(subjectTitleElement);
                        questionsInCurrentColumn++; // Count subject title as space
                    }
                }
                
                // Add the question
                const questionElement = createQuestionElement(question, i + 1);
                currentColumnElement.appendChild(questionElement);
                questionsInCurrentColumn++;
            }
        }

        function createPageContainer(parent, pageNumber) {
            const pageContainer = document.createElement('div');
            pageContainer.className = 'page-container';
            pageContainer.id = `page-${pageNumber}`;
            parent.appendChild(pageContainer);
            return pageContainer;
        }

        function createColumn(parent, columnNumber) {
            const column = document.createElement('div');
            column.className = 'column';
            column.id = `column-${columnNumber}`;
            parent.appendChild(column);
            return column;
        }

        function createQuestionElement(question, questionNumber) {
            const questionElement = document.createElement('div');
            questionElement.className = 'question';

            // Question Number
            const questionNumberElement = document.createElement('div');
            questionNumberElement.className = 'question-number';
            questionNumberElement.textContent = `Question ${questionNumber}:`;
            questionElement.appendChild(questionNumberElement);

            // Question Content
            const questionContent = document.createElement('div');
            questionContent.className = 'question-content';
            questionContent.innerHTML = question.content.replace(/\$\$(.*?)\$\$/g, (match, p1) => {
                return `<span class="mathjax-inline">$$${p1}$$</span>`;
            });
            questionElement.appendChild(questionContent);

            // Options
            const optionsList = document.createElement('ul');
            optionsList.className = 'options';

            question.options.forEach(option => {
                const optionItem = document.createElement('li');
                const optionLabel = document.createElement('label');
                const optionInput = document.createElement('input');

                optionInput.type = 'radio';
                optionInput.name = `question${question.question_id}`;
                optionInput.value = option.identifier;

                optionLabel.appendChild(optionInput);
                optionLabel.innerHTML += option.content;
                optionItem.appendChild(optionLabel);
                optionsList.appendChild(optionItem);
            });

            questionElement.appendChild(optionsList);

            return questionElement;
        }

        function estimateQuestionsPerPage() {
            // Estimate how many questions can fit in one column of an A4 page
            // This is a rough estimate and may need adjustment
            if (window.innerWidth <= 768) { // Mobile
                return 3;
            } else { // Desktop
                return 10;
            }
        }

        // Prevent page refresh or navigation
        window.onbeforeunload = function (event) {
            return "Are you sure you want to leave? Your progress may be lost.";
        };
    </script>
</body>
</html>
