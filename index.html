<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Game</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            color: #333;
        }
        #container {
            width: 80%;
            max-width: 800px;
            margin: auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            text-align: center;
        }
        #setup, #quiz, #result, #history {
            display: none;
        }
        #setup {
            display: block;
            margin-bottom: 20px;
        }
        .button {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .button:hover {
            background-color: #218838;
        }
        .progress-bar {
            width: 100%;
            background: #f3f3f3;
            border-radius: 5px;
            margin: 20px 0;
        }
        .progress {
            height: 20px;
            background: #4caf50;
            width: 0;
            border-radius: 5px;
        }
        .correct { color: green; }
        .wrong { color: red; }
        #timer { font-size: 20px; text-align: right; }
        .result-item {
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
        }
        #history button {
            margin: 5px;
        }
        #questionNumbers {
            display: flex;
            justify-content: center;
            margin-bottom: 10px;
        }
        #questionNumbers button {
            margin: 0 5px;
            padding: 5px;
            border: 1px solid #007bff;
            background: white;
            color: #007bff;
            border-radius: 5px;
            cursor: pointer;
        }
        #questionNumbers button.selected {
            background: #007bff;
            color: white;
        }
        #questionNumbers button.solving {
            background: #ffc107;
            color: white;
        }
        #questionNumbers button.upcoming:hover {
            background: #e7f3ff;
        }
    </style>
</head>
<body>
    <div id="container">
        <h1><i class="fas fa-question-circle"></i> Quiz Game</h1>
        <div id="setup">
            <label for="numQuestions"><i class="fas fa-list-alt"></i> Number of Questions: </label>
            <input type="number" id="numQuestions" min="1" max="15" placeholder="5">
            <label for="subject"><i class="fas fa-book"></i> Select Subject:</label>
            <select id="subject">
                <option value="biology">Biology</option>
            </select>
            <button id="startButton" class="button"><i class="fas fa-play"></i> Start</button>
        </div>
        <div id="quiz">
            <div id="timer"></div>
            <div class="progress-bar">
                <div class="progress" id="progress"></div>
            </div>
            <div id="questionNumbers"></div>
            <div id="questionContainer">
                <div id="question" class="question"></div>
                <ul id="options" class="options"></ul>
            </div>
            <button id="prevButton" class="button"><i class="fas fa-arrow-left"></i> Previous</button>
            <button id="nextButton" class="button"><i class="fas fa-arrow-right"></i> Next</button>
            <button id="submitButton" class="button"><i class="fas fa-check"></i> Submit</button>
        </div>
        <div id="result"></div>
        <div id="history"></div>
    </div>

    <script>
        const biologyQuestions = [
            { question: "The oversized amoeba cells that are part of our innate immune system found in areolar tissue are called:", options: ["Macrophages", "Mast cells", "Fibroblasts", "Adipocytes"], correct: 0 },
            { question: "Cells that release heparin and histamine into the blood are:", options: ["Basophils", "Mast cells", "Eosinophils", "Neutrophils"], correct: 0 },
            { question: "This feature is not found in Periplaneta Americana:", options: ["During embryonic development, indeterminate and radial cleavage occur", "Schizocoelom as the body cavity", "Metamerically segmented body", "Exoskeleton composed of N-acetyl glucose-amine"], correct: 0 },
            { question: "The function of the gap junction is to:", options: ["Facilitates communication between neighboring cells by quickly connecting the cytoplasm. Movement of ions, small molecules, and some large molecules", "Prevent substances from leaking through tissues", "Separate two cells from each other", "Perform cementation to join adjacent cells."], correct: 0 },
            { question: "This accurately describes an animal:", options: ["Earthworm – the alimentary canal consists of a sequence of the pharynx, esophagus, stomach, gizzard, and intestine", "Rat – left kidney is slightly higher in position than the correct one", "Cockroach – 10 pairs of spiracles (8 pairs on the abdomen and 2 pairs on the thorax)", "Frog — body divisible into three regions — head, neck, and trunk"], correct: 0 },
            { question: "In which of the following preparations are you likely to come across cell junctions most frequently?", options: ["Hyaline cartilage", "Thrombocytes", "Ciliated epithelium", "Tendon"], correct: 2 },
            { question: "The non-excitable, variously shaped, and found between neurons are:", options: ["Dendrites", "Nissibodies", "Glial cells", "Schwann cell"], correct: 2 },
            { question: "How are skeletal muscles similar to visceral muscles?", options: ["Shape of muscle fibers.", "Muscle fibers have a certain number of nuclei.", "Presence of actin and myosin filaments.", "Presence of light and dark bands."], correct: 2 },
            { question: "Which ion is necessary for the contraction of a muscle and nerve impulse transmission?", options: ["N+", "K+", "Ca++", "None of the above"], correct: 2 },
            { question: "Bipolar neurons are found in human ______:", options: ["Brain", "Spinal cord", "Embryonic stages", "Olfactory epithelium"], correct: 3 },
            { question: "The epiglottis, pinna, and tip of the nose contain the following types of cartilage:", options: ["Elastic", "Hyaline", "Fibrous", "Calcified"], correct: 0 },
            { question: "What type of animal tissue changes a blood vessel’s diameter?", options: ["Epithelium", "Connective", "Muscle", "Neural"], correct: 2 },
            { question: "The body cells in cockroaches discharge their nitrogenous waste in the hemolymph mainly as:", options: ["Ammonia", "Potassium urate", "Urea", "Calcium carbonate"], correct: 1 },
            { question: "The kind of epithelium which forms the inner walls of blood vessels is:", options: ["Cuboidal epithelium", "Columnar epithelium", "Ciliated columnar epithelium", "Squamous epithelium"], correct: 3 },
            { question: "The epithelial tissue on the inner surface of bronchioles and fallopian tubes is:", options: ["Cuboidal", "Glandular", "Ciliated", "Squamous"], correct: 2 },
            { question: "In which part of the reproductive system is male cockroach sperm stored?", options: ["Vas Deferens", "Testes", "Mushroom glands", "Seminal vesicles"], correct: 3 }
        ];

        const subjects = {
            biology: biologyQuestions,
        };

        let selectedQuestions = [];
        let userAnswers = [];
        let currentQuestion = 0;
        let numQuestions = 0;
        let quizHistory = JSON.parse(localStorage.getItem('quizHistory')) || [];
        let timerInterval;
        let timeLeft = 0; // Total time in seconds

        document.getElementById('startButton').addEventListener('click', startQuiz);
        document.getElementById('prevButton').addEventListener('click', () => changeQuestion(-1));
        document.getElementById('nextButton').addEventListener('click', () => changeQuestion(1));
        document.getElementById('submitButton').addEventListener('click', submitQuiz);

        function startQuiz() {
            const subject = document.getElementById('subject').value;
            numQuestions = parseInt(document.getElementById('numQuestions').value) || 5;
            selectedQuestions = getRandomQuestions(numQuestions, subject);
            userAnswers = new Array(numQuestions).fill(null);
            currentQuestion = 0;
            timeLeft = numQuestions * 60; // Total time in seconds
            document.getElementById('setup').style.display = 'none';
            document.getElementById('quiz').style.display = 'block';
            displayQuestion();
            startTimer();
            updateProgressBar();
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').innerText = `Time Left: ${Math.floor(timeLeft / 60)}:${(timeLeft % 60 < 10 ? '0' : '')}${timeLeft % 60}`;
                updateProgressBar();
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    alert("Time's up! Submitting your quiz.");
                    submitQuiz();
                }
            }, 1000);
        }

        function updateProgressBar() {
            const progress = ((currentQuestion + 1) / numQuestions) * 100;
            document.getElementById('progress').style.width = `${progress}%`;
        }

        function getRandomQuestions(num, subject) {
            const questions = subjects[subject];
            if (questions.length < num) {
                alert(`Not enough questions available in ${subject}. Showing ${questions.length} questions instead.`);
                num = questions.length;
            }
            const shuffled = questions.sort(() => 0.5 - Math.random());
            return shuffled.slice(0, num);
        }

        function displayQuestion() {
            const question = selectedQuestions[currentQuestion];
            document.getElementById('question').innerText = question.question;
            const options = document.getElementById('options');
            options.innerHTML = '';
            question.options.forEach((option, index) => {
                const li = document.createElement('li');
                const input = document.createElement('input');
                input.type = 'radio';
                input.name = 'option';
                input.value = index;
                if (userAnswers[currentQuestion] === index) {
                    input.checked = true;
                }
                input.addEventListener('change', () => userAnswers[currentQuestion] = index);
                li.appendChild(input);
                li.appendChild(document.createTextNode(option));
                options.appendChild(li);
            });
            updateQuestionNumbers();
        }

        function changeQuestion(direction) {
            currentQuestion += direction;
            if (currentQuestion >= numQuestions) {
                alert("Questions ended. Please submit your answers.");
                currentQuestion = numQuestions - 1;
            } else if (currentQuestion < 0) {
                currentQuestion = 0;
            }
            displayQuestion();
        }

        function updateQuestionNumbers() {
            const questionNumbers = document.getElementById('questionNumbers');
            questionNumbers.innerHTML = '';
            for (let i = 0; i < numQuestions; i++) {
                const button = document.createElement('button');
                button.innerText = i + 1;
                if (userAnswers[i] !== null) {
                    button.classList.add('selected');
                } else if (i === currentQuestion) {
                    button.classList.add('solving');
                } else {
                    button.classList.add('upcoming');
                }
                button.addEventListener('click', () => {
                    currentQuestion = i;
                    displayQuestion();
                });
                questionNumbers.appendChild(button);
            }
        }

        function submitQuiz() {
            clearInterval(timerInterval); // Stop the timer
            let score = 0;
            let correctCount = 0;
            let incorrectCount = 0;
            let missedCount = 0;

            selectedQuestions.forEach((question, i) => {
                const userAnswer = userAnswers[i];
                const isCorrect = userAnswer === question.correct;
                if (isCorrect) {
                    score += 4;
                    correctCount++;
                } else if (userAnswer !== null) {
                    score -= 1;
                    incorrectCount++;
                } else {
                    missedCount++;
                }
            });

            const totalMarks = numQuestions * 4; // Maximum marks
            const percentage = (score / totalMarks) * 100;
            const averageTime = ((numQuestions * 60) / numQuestions); // Average time per question in seconds
            const averageTimeDisplay = `${Math.floor(averageTime / 60)}:${(averageTime % 60 < 10 ? '0' : '')}${averageTime % 60} mins`;

            const resultContainer = document.getElementById('result');
            resultContainer.innerHTML = `
                <h2>Results</h2>
                <p><strong>Total Questions:</strong> ${numQuestions}</p>
                <p><strong>Correct:</strong> ${correctCount}</p>
                <p><strong>Incorrect:</strong> ${incorrectCount}</p>
                <p><strong>Missed:</strong> ${missedCount}</p>
                <p><strong>Total Marks Obtained:</strong> ${score} / ${totalMarks}</p>
                <p><strong>Percentage:</strong> ${percentage.toFixed(2)}%</p>
                <p><strong>Average Time Taken per Question:</strong> ${averageTimeDisplay}</p>
                <h3>Detailed Results:</h3>
                ${selectedQuestions.map((question, i) => `
                    <div class="result-item">
                        <p><strong>Question ${i + 1}:</strong> ${question.question}</p>
                        <p class="${userAnswers[i] === question.correct ? 'correct' : 'wrong'}">
                            Your answer: ${userAnswers[i] !== null ? question.options[userAnswers[i]] : 'No answer'}
                            ${userAnswers[i] !== null && userAnswers[i] !== question.correct ? `<br>Correct answer: ${question.options[question.correct]}` : ''}
                        </p>
                    </div>
                `).join('')}
            `;

            document.getElementById('quiz').style.display = 'none';
            resultContainer.style.display = 'block';

            // Save the result to history
            const quizResult = {
                date: new Date().toLocaleString(),
                questions: selectedQuestions,
                answers: userAnswers,
                score: score
            };
            quizHistory.push(quizResult);
            localStorage.setItem('quizHistory', JSON.stringify(quizHistory));
            displayHistory();
        }

        function displayHistory() {
            const historyContainer = document.getElementById('history');
            historyContainer.innerHTML = '<h2>History</h2>';
            quizHistory.forEach((quiz, index) => {
                const historyItem = document.createElement('div');
                historyItem.innerHTML = `
                    <p><strong>Quiz ${index + 1}</strong> - ${quiz.date} - Score: ${quiz.score}</p>
                    <button class="button" onclick="viewHistory(${index})"><i class="fas fa-eye"></i> View</button>
                `;
                historyContainer.appendChild(historyItem);
            });
            historyContainer.style.display = 'block';
        }

        function viewHistory(index) {
            const quiz = quizHistory[index];
            const resultContainer = document.getElementById('result');
            resultContainer.innerHTML = `<h2>Quiz on ${quiz.date}</h2>`;
            quiz.questions.forEach((question, i) => {
                const userAnswer = quiz.answers[i];
                const isCorrect = userAnswer === question.correct;
                const result = document.createElement('div');
                result.className = 'result-item';
                result.innerHTML = `
                    <p><strong>Question ${i + 1}:</strong> ${question.question}</p>
                    <p class="${isCorrect ? 'correct' : 'wrong'}">
                        Your answer: ${userAnswer !== null ? question.options[userAnswer] : 'No answer'}
                        ${!isCorrect ? `<br>Correct answer: ${question.options[question.correct]}` : ''}
                    </p>
                `;
                resultContainer.appendChild(result);
            });
            document.getElementById('quiz').style.display = 'none';
            resultContainer.style.display = 'block';
        }

        // Initialize history display
        displayHistory();
    </script>
</body>
</html>
