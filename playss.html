let quizData = [];
const urlParams = new URLSearchParams(window.location.search);
const total = parseInt(urlParams.get('total'), 10) || 15;

const metaIds = [
    { id: "3c48616f-298a-5f69-91d2-bcd59444c455", title: "NEET 2023 Manipur" },
    { id: "cbfbed57-d7d8-5a07-9957-478e4cb62f17", title: "NEET 2023" },
    { id: "8dd253c6-09a8-5875-b127-a0c00a165a1b", title: "NEET 2022 Phase 2" }
];

const selectedMetaIds = shuffleArray(metaIds).slice(0, 3);
let fetchedSubjects = 0;
let allQuestions = [];

selectedMetaIds.forEach(meta => {
    fetch(`https://raw.githubusercontent.com/itzfew/Quizes/refs/heads/main/pyq/${meta.id}.json`)
        .then(response => response.json())
        .then(data => {
            allQuestions.push(...shuffleArray(data.questions));
            fetchedSubjects++;
            if (fetchedSubjects === selectedMetaIds.length) {
                distributeQuestions();
            }
        })
        .catch(error => console.error('Error fetching JSON:', error));
});

function distributeQuestions() {
    const subjectCount = selectedMetaIds.length;
    const perSubject = Math.ceil(total / subjectCount);
    let arrangedQuestions = [];
    
    for (let i = 0; i < subjectCount; i++) {
        arrangedQuestions.push(...allQuestions.slice(i * perSubject, (i + 1) * perSubject));
    }
    
    displayQuestions(arrangedQuestions.slice(0, total));
}

function displayQuestions(questions) {
    const quizContainer = document.getElementById('quiz-container');
    quizContainer.innerHTML = '';
    
    questions.forEach((question, index) => {
        const questionElement = document.createElement('div');
        questionElement.className = 'question';
        questionElement.innerHTML = `<div class='question-number'>Question ${index + 1}:</div><div class='question-content'>${question.content}</div>`;
        quizContainer.appendChild(questionElement);
    });
}

function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}
