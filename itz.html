<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NEET Practice</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  <style>
    body { font-family: sans-serif; margin: 0; padding: 1rem; background: #f4f4f4; }
    h2, h3 { margin: 0.5rem 0; }
    .question-nav { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 1rem; }
    .question-nav button { width: 30px; height: 30px; border-radius: 50%; border: none; cursor: pointer; background: #ddd; }
    .question-nav button.correct { background: #4caf50; color: white; }
    .question-nav button.incorrect { background: #f44336; color: white; }
    .question-nav button.current { border: 2px solid #000; }
    .option { padding: 8px; margin: 6px 0; background: #fff; border: 1px solid #ccc; cursor: pointer; }
    .option.selected { background: #ffeeba; }
    .option.correct { background: #c8e6c9; }
    .option.incorrect { background: #ffcdd2; }
    .question-box { background: #fff; padding: 1rem; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .hidden { display: none; }
    #result-box { margin-top: 2rem; padding: 1rem; background: #fff; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
  </style>
</head>
<body>

<h2>NEET Practice</h2>
<input type="number" id="numQuestions" placeholder="Enter number of questions">
<button onclick="generateQuestions()">Start</button>

<div class="question-nav" id="questionNav"></div>
<div id="quizContainer"></div>
<div id="result-box" class="hidden"></div>

<script>
const subjects = ['biology', 'chemistry', 'physics'];
const metaIds = [
  "3c48616f-298a-5f69-91d2-bcd59444c455", "cbfbed57-d7d8-5a07-9957-478e4cb62f17", "8dd253c6-09a8-5875-b127-a0c00a165a1b", // ...add more
];
let allQuestions = [];
let userAnswers = {};
let currentIndex = 0;

async function fetchAllQuestions() {
  let all = [];
  for (let id of metaIds) {
    const url = `https://raw.githubusercontent.com/itzfew/Quizes/refs/heads/main/pyq/${id}.json`;
    try {
      const res = await fetch(url);
      const data = await res.json();
      all.push(...data[0].questions, ...data[1].questions, ...data[2].questions);
    } catch (e) {
      console.error('Failed fetching', id);
    }
  }
  return all;
}

function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

function renderMath() {
  MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
}

function renderQuestion(index) {
  const q = allQuestions[index];
  const container = document.getElementById('quizContainer');
  container.innerHTML = `
    <div class="question-box">
      <h3>Q${index + 1}. (${q.subject.toUpperCase()})</h3>
      <div>${q.content.replace(/\$\$(.*?)\$\$/g, '<span class="mathjax">$$$1$$</span>')}</div>
      <div id="options">
        ${q.options.map(opt => `
          <div class="option" data-id="${opt.identifier}">
            ${opt.identifier}. ${opt.content.replace(/\$\$(.*?)\$\$/g, '<span class="mathjax">$$$1$$</span>')}
          </div>
        `).join('')}
      </div>
      <button onclick="checkAnswer(${index})">Check</button>
      <div class="explanation hidden" id="explanation">
        <strong>Explanation:</strong>
        <div>${q.explanation.replace(/\$\$(.*?)\$\$/g, '<span class="mathjax">$$$1$$</span>')}</div>
      </div>
    </div>
  `;
  renderMath();
  document.querySelectorAll('.option').forEach(opt => {
    opt.onclick = () => {
      document.querySelectorAll('.option').forEach(o => o.classList.remove('selected'));
      opt.classList.add('selected');
      userAnswers[q.question_id] = opt.dataset.id;
      localStorage.setItem(q.question_id, opt.dataset.id);
    };
  });
  updateNav();
}

function checkAnswer(index) {
  const q = allQuestions[index];
  const correct = q.answer;
  const user = userAnswers[q.question_id];

  document.querySelectorAll('.option').forEach(opt => {
    if (opt.dataset.id === correct) opt.classList.add('correct');
    else if (opt.dataset.id === user) opt.classList.add('incorrect');
  });
  document.getElementById('explanation').classList.remove('hidden');
  updateNav();
}

function updateNav() {
  const nav = document.getElementById('questionNav');
  nav.innerHTML = allQuestions.map((q, i) => {
    const ans = userAnswers[q.question_id];
    const correct = q.answer;
    let cls = '';
    if (ans) {
      cls = ans === correct ? 'correct' : 'incorrect';
    }
    if (i === currentIndex) cls += ' current';
    return `<button class="${cls}" onclick="goTo(${i})">${i + 1}</button>`;
  }).join('');
}

function goTo(i) {
  currentIndex = i;
  renderQuestion(i);
}

function generateQuestions() {
  const n = parseInt(document.getElementById('numQuestions').value);
  if (!n || n < 3) return alert("Minimum 3 questions required");

  fetchAllQuestions().then(all => {
    const perSubject = Math.floor(n / 3);
    const remainder = n % 3;
    allQuestions = [];

    subjects.forEach((subj, idx) => {
      let count = perSubject + (idx === 0 ? (remainder > 0) : (idx === 1 && remainder > 1) ? 1 : 0);
      const subQs = shuffle(all.filter(q => q.subject === subj)).slice(0, count);
      allQuestions.push(...subQs);
    });

    currentIndex = 0;
    userAnswers = {};
    renderQuestion(0);
  });
}

function showResult() {
  let score = 0, attempted = 0;
  allQuestions.forEach(q => {
    const ans = userAnswers[q.question_id];
    if (ans) {
      attempted++;
      if (ans === q.answer) score += 4;
      else score -= 1;
    }
  });
  document.getElementById('result-box').innerHTML = `
    <h3>Result</h3>
    <p>Total Questions: ${allQuestions.length}</p>
    <p>Attempted: ${attempted}</p>
    <p>Score: ${score}</p>
  `;
  document.getElementById('result-box').classList.remove('hidden');
}
</script>

<button onclick="showResult()">Show Result</button>

</body>
</html>
